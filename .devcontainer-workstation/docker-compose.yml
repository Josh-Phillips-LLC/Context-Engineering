services:
  implementation-workstation:
    build:
      context: ..
      dockerfile: .devcontainer-workstation/Dockerfile
      args:
        IMAGE_ROLE_PROFILE: implementation-specialist
    container_name: implementation-workstation
    volumes:
      - implementation_projects_data:/workspace
      - implementation_gh_config:/root/.config/gh
      - implementation_git_config:/root/.config/git
      # - ssh_data:/root/.ssh
      - implementation_codex_home:/root/.codex
      # Optional: forward host SSH agent into container for commit signing.
      # Set HOST_SSH_AGENT_SOCK before compose up.
      # - type: bind
      #  source: ${HOST_SSH_AGENT_SOCK:-/tmp/codex-no-ssh-agent}
      #  target: /ssh-agent
    environment:
      - GH_TOKEN=${GH_TOKEN:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WORKSTATION_DEBUG=${WORKSTATION_DEBUG:-false}
      - CODEX_HOME=/root/.codex
      # - SSH_AUTH_SOCK=/ssh-agent
      - ROLE_PROFILE=${ROLE_PROFILE:-implementation-specialist}
      - WORKSPACE_REPO_OWNER=${WORKSPACE_REPO_OWNER:-Josh-Phillips-LLC}
      - WORKSPACE_REPO_URL=${IMPLEMENTATION_WORKSPACE_REPO_URL:-https://github.com/Josh-Phillips-LLC/context-engineering-role-implementation-specialist.git}
      - WORKSPACE_REPO_DIR=/workspace/Projects/${IMPLEMENTATION_WORKSPACE_REPO_DIR_NAME:-context-engineering-role-implementation-specialist}
      - AUTO_CLONE_WORKSPACE_REPO=${AUTO_CLONE_WORKSPACE_REPO:-true}

    # Testing-mode autonomy
    cap_add:
      - ALL
    privileged: true
    init: true
    entrypoint: ["/usr/local/bin/init-workstation.sh"]
    command: ["sleep", "infinity"]

  compliance-workstation:
    build:
      context: ..
      dockerfile: .devcontainer-workstation/Dockerfile
      args:
        IMAGE_ROLE_PROFILE: compliance-officer
    container_name: compliance-workstation
    profiles:
      - compliance-officer
    volumes:
      - compliance_projects_data:/workspace
      - compliance_gh_config:/root/.config/gh
      - compliance_git_config:/root/.config/git
      # - ssh_data:/root/.ssh
      - compliance_codex_home:/root/.codex
      # Optional: forward host SSH agent into container for commit signing.
      # Set HOST_SSH_AGENT_SOCK before compose up.
      # - type: bind
      #  source: ${HOST_SSH_AGENT_SOCK:-/tmp/codex-no-ssh-agent}
      #  target: /ssh-agent
    environment:
      - GH_TOKEN=${GH_TOKEN:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WORKSTATION_DEBUG=${WORKSTATION_DEBUG:-false}
      - CODEX_HOME=/root/.codex
      # - SSH_AUTH_SOCK=/ssh-agent
      - ROLE_PROFILE=compliance-officer
      - WORKSPACE_REPO_OWNER=${WORKSPACE_REPO_OWNER:-Josh-Phillips-LLC}
      - WORKSPACE_REPO_URL=${COMPLIANCE_WORKSPACE_REPO_URL:-https://github.com/Josh-Phillips-LLC/context-engineering-role-compliance-officer.git}
      - WORKSPACE_REPO_DIR=/workspace/Projects/${COMPLIANCE_WORKSPACE_REPO_DIR_NAME:-context-engineering-role-compliance-officer}
      - AUTO_CLONE_WORKSPACE_REPO=${AUTO_CLONE_WORKSPACE_REPO:-true}

    # Testing-mode autonomy
    cap_add:
      - ALL
    privileged: true
    init: true
    entrypoint: ["/usr/local/bin/init-workstation.sh"]
    command: ["sleep", "infinity"]

  systems-architect-workstation:
    build:
      context: ..
      dockerfile: .devcontainer-workstation/Dockerfile
      args:
        IMAGE_ROLE_PROFILE: systems-architect
    container_name: systems-architect-workstation
    profiles:
      - systems-architect
    volumes:
      - systems_architect_projects_data:/workspace
      - systems_architect_gh_config:/root/.config/gh
      - systems_architect_git_config:/root/.config/git
      # - ssh_data:/root/.ssh
      - systems_architect_codex_home:/root/.codex
      # Optional: forward host SSH agent into container for commit signing.
      # Set HOST_SSH_AGENT_SOCK before compose up.
      # - type: bind
      #  source: ${HOST_SSH_AGENT_SOCK:-/tmp/codex-no-ssh-agent}
      #  target: /ssh-agent
    environment:
      - GH_TOKEN=${GH_TOKEN:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WORKSTATION_DEBUG=${WORKSTATION_DEBUG:-false}
      - CODEX_HOME=/root/.codex
      # - SSH_AUTH_SOCK=/ssh-agent
      - ROLE_PROFILE=systems-architect
      - WORKSPACE_REPO_OWNER=${WORKSPACE_REPO_OWNER:-Josh-Phillips-LLC}
      - WORKSPACE_REPO_URL=${SYSTEMS_ARCHITECT_WORKSPACE_REPO_URL:-https://github.com/Josh-Phillips-LLC/context-engineering-role-systems-architect.git}
      - WORKSPACE_REPO_DIR=/workspace/Projects/${SYSTEMS_ARCHITECT_WORKSPACE_REPO_DIR_NAME:-context-engineering-role-systems-architect}
      - AUTO_CLONE_WORKSPACE_REPO=${AUTO_CLONE_WORKSPACE_REPO:-true}

    # Testing-mode autonomy
    cap_add:
      - ALL
    privileged: true
    init: true
    entrypoint: ["/usr/local/bin/init-workstation.sh"]
    command: ["sleep", "infinity"]

volumes:
  implementation_projects_data:
  implementation_gh_config:
  implementation_git_config:
  implementation_codex_home:
  compliance_projects_data:
  compliance_gh_config:
  compliance_git_config:
  compliance_codex_home:
  systems_architect_projects_data:
  systems_architect_gh_config:
  systems_architect_git_config:
  systems_architect_codex_home:
  # ssh_data:
